name: Sync Forks

on:
  schedule:
    - cron: "47 11 * * *" # once every day
  push:
    paths:
      - .github/workflows/sync-forks.yml

permissions:
  contents: write

env:
  # Token must be created by someone with write access for all forks.
  # Be sure to 'configure SSO' from the token creation page for each fork organization.
  GH_TOKEN: ${{ secrets.SYNC_FORK_TOKEN }}
  UPSTREAM_OWNER: CCBR

jobs:
  sync:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        FORK_OWNER: [NCIPangea, abcsFrederick]
        REPO: [ASPEN, CARLISLE, CHAMPAGNE, CRUISE, RENEE, XAVIER]
        include:
          - REPO: ASCENT
            FORK_OWNER: abcsFrederick
          - REPO: CCBR_circRNA_AmpliconSeq
            FORK_OWNER: abcsFrederick
          - REPO: DNAnexus
            FORK_OWNER: abcsFrederick
          - REPO: HapFerret
            FORK_OWNER: abcsFrederick
          - REPO: HERVx
            FORK_OWNER: abcsFrederick
          - REPO: l2p
            FORK_OWNER: abcsFrederick
          - REPO: METRO
            FORK_OWNER: abcsFrederick
          #- REPO: MAAPSTER
          #  FORK_OWNER: abcsFrederick
          - REPO: SINCLAIR
            FORK_OWNER: abcsFrederick
          - REPO: TRANQUIL
            FORK_OWNER: abcsFrederick
          - REPO: LOGAN
            FORK_OWNER: abcsFrederick
            
    steps:
      - name: sync forked repos
        run: |
          gh repo sync ${{ matrix.FORK_OWNER }}/${{ matrix.REPO }} --source $UPSTREAM_OWNER/${{ matrix.REPO }} --force
